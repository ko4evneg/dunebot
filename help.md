# РЕЙТИНГ-БОТ ДЮНЫ

# <a id="home"/> Оглавление

[Как найти бота](#chat)\
[Регистрация игрока](#register)\
[Изменение данных игрока](#refresh-profile)\
[Изменение данных игрока](#refresh-profile)\
[Создание опроса](#create-poll)\
[Удаление опроса](#delete-poll)\
[Регистрация результатов](#result-submit)\
[Дополнительные действия победившего игрока при регистрации результатов](#winner-actions)\
[Игроки-гости](#guest-players)\
[Рейтинг](#rating)\
[Примеры работы бота](#examples)\
[Список всех команд](#commands)

## <a id="chat"/> Как найти бота

Бота можно найти в Telegram по нику <b>@tabledune_bot</b>.\
Все команды нужно отправлять боту <b>в этом чате</b>.

## <a id="register"/> Регистрация игрока

Для участия в рейтинге необходима регистрация игрока в боте. Для регистрации просто выполните команду в личном чате с
ботом: `/register Имя (ник_steam) Фамилия`. При регистрации бот сохранит для рейтинга ваши данные и чат в который будет в
дальнейшем отправлять вам уведомления. К сожалению, всем текущим игрокам, придется зарегистрироваться еще раз, так как в текущих
таблицах нет данных об их телеграм чатах.\
**Внимание:** если вы уже заходили в опросы бота до регистрации, значит вы находитесь в статусе игрока-гостя. Чтобы закончить
регистрацию гостя вам нужно выполнить команду `/refresh_profile Имя (ник_steam) Фамилия` в чате с ботом. Подробнее об 
игроке-госте [тут](#guest-players)\
\
[В начало...](#home)

## <a id="refresh-profile"/> Изменение данных игрока

Изменить данные игрока возможно командой `/refresh_profile Имя (ник_steam) Фамилия`. Даже если вы хотите поменять только
одно имя, вписывать необходимо все три имени (те, которые не меняете в этом случае совпадут с указанными при регистрации).
Также эту команду необходимо выполнить для обновления данных у бота, если вы меняете данные в Telegram (фамилия, имя, 
ник) - **иначе у вас не будут работать уведомления бота типа @telegramName**. \
\
[В начало...](#home)

## <a id="create-poll"/> Создание опроса

Для создания опроса выполните команду `/new dune` или `/new up4` для создания классического или uprising опроса,
соответственно. Когда в опросе будет 4 игрока, начнется минутный отсчет, по истечении которого, если из опроса никто 
не выйдет, в чат опроса будет отправлено уведомление о готовности игры, а также **ID_игры** этой партии.\
\
[В начало...](#home)

## <a id="delete-poll"/> Удаление опроса

Удалить возможно только последний созданный опрос, по которому еще не началась регистрация результатов.
Для удаления опроса выполните команду `/cancel`.\
\
[В начало...](#home)

## <a id="result-submit"/> Регистрация результатов

По окончании игры, необходимо зарегистрировать ее результаты. Для запуска регистрации выполните команду `/submit ID_игры`.
Команду может выполнить любой игрок, участвующий в матче. При выполнении команды, **всем** положительно ответившим в опросе
игрокам будет выслано сообщение с опциями выбора занятого места. Как только каждый игрок укажет свое место, будет проведена
валидация результата - если несколько претендуют на место, процесс регистрации начнется повторно. Бот разрешает 3 повторных
попытки для регистрации результата. Если консенсус не будет достигнут, регистрация закроется и результат матча не будет
учитываться в рейтинге. Также повторную регистрацию результатов можно вызвать командой `/resubmit ID_игры` - например в
случае, если по ошибке было выбрано неправильное место. Вызов этой команды также уменьшает количество повторных попыток
регистрации.\
В случае, когда кто-то из игроков не отвечает на запрос регистрации результата, матч будет завершен автоматически через
2 часа. Если не отвечает игрок, ответивший в опросе положительно, но не участвующий в матче (пятый игрок), то матч будет
учтен в рейтинге, в противном случае - матч не будет учитываться.\
_В реализации: Игроки регулярно не отвечающие на запрос результатов, либо регулярно вызывающие конфликт, указывая
чужие места, будут баниться из рейтинга на возрастающий с каждым нарушением срок._\
\
[В начало...](#home)

## <a id="winner-actions"/> Дополнительные действия победившего игрока при регистрации результатов

Кроме опроса места, у победителя есть задача загрузить скриншот матча. После выбора первого места на регистрации результатов,
ему придет запрос на загрузку скриншота. Для загрузки нужно просто перетащить скриншот в чат с ботом, после получения запроса.
Загрузить можно только картинку (не файл!), как сжатую телеграмом, так и не сжатую. Максимальный размер скриншота: 6.5 Мб, 
разрешенные форматы: jpg, jpeg, png.\
_В реализации: После загрузки скриншота, победителю также придет дополнительный опрос с просьбой указать лидера, которым
он играл._\
\
[В начало...](#home)

## <a id="guest-players"/> Игроки-гости

Игроки без регистрации так же могут принять участие в матче - им точно так же придут запросы на выбор места и загрузку 
скриншота. Однако на таких игроков наложен ряд ограничений:
- не участвуют в рейтинге
- не могут создавать матчи 
- не могут использовать часть команд бота
- имеют имя Vasya (guest111) Pupkin


[В начало...](#home)

## <a id="rating"/> Рейтинг

По окончании месяца, в чат будет выслан pdf файл с результатами рейтинга за этот месяц.\
Формула расчета эффективности сохранена из старого рейтинга:
![alt text](help/efficiency.jpg)\
_В реализации: 15 числа месяца, в чат будет выслан pdf файл с промежуточными результатами этого месяца._\
\
[В начало...](#home)

# <a id="examples"/>Примеры работы бота

### Регистрация и обновление данных профиля

![alt text](help/register.jpg)

### Создание матча

![alt text](help/new_request.jpg)\
Сообщение о сборе в соответствующем чате (классика или uprising):\
![alt text](help/new_reply.jpg)\
Сообщение через минуту, после сбора 4 игроков\
![alt text](help/match_start.jpg)

### Регистрация результатов

Запрос на регистрацию (от любого участника):\
![alt text](help/submit_request.jpg)\
Опрос для каждого игрока:\
![alt text](help/submit_reply.jpg)\
Когда все проголосовали (запрос скриншота только у победителя):\
![alt text](help/submit_reply2.jpg)\
Загрузка скриншота:\
![alt text](help/submit_screenshot.jpg)\
Сообщение о результатах в соответствующем чате (классика или uprising):\
![alt text](help/match_finish.jpg)\

### Конфликт результатов

![alt text](help/resubmit.jpg)\
Превышение лимита конфликтов результатов:\
![alt text](help/resubmit_fail1.jpg)\
Сообщение о результатах в соответствующем чате (классика или uprising):\
![alt text](help/resubmit_fail2.jpg)\

\
[В начало...](#home)

# <a id="commands"/> Список всех команд

`/register Имя (ник_steam) Фамилия` Регистрация игрока в рейтинге\
`/refresh_profile Имя (ник_steam) Фамилия` Изменение данных существующего игрока\
`/new dune` Создание опроса для классической Dune\
`/new up4` Создание опроса для Dune Uprising (4 игрока)\
`/cancel` Удаление последнего опроса, созданного игроком\
`/submit ID_игры` Запуск регистрации результатов игры с номером **ID_игры**\
`/resubmit ID_игры` Запуск регистрации результатов игры заново. Возможно выполнить до трех раз на игру\
`/help` Помощь\
\
[В начало...](#home)
